"use strict";WaveSurfer.Regions={init:function(e){this.wavesurfer=e,this.wrapper=this.wavesurfer.drawer.wrapper,this.list={}},add:function(e){var t=Object.create(WaveSurfer.Region);return t.init(e,this.wavesurfer),this.list[t.id]=t,t.on("remove",function(){delete this.list[t.id]}.bind(this)),t},clear:function(){Object.keys(this.list).forEach(function(e){this.list[e].remove()},this)},enableDragSelection:function(e){var i,r,a,t=this;this.wrapper.addEventListener("mousedown",function(e){i=!0,r=t.wavesurfer.drawer.handleEvent(e),a=null}),this.wrapper.addEventListener("mouseup",function(e){i=!1,a&&(a.fireEvent("update-end",e),t.wavesurfer.fireEvent("region-update-end",a,e)),a=null}),this.wrapper.addEventListener("mousemove",function(n){if(i){a||(a=t.add(e||{}));var s=t.wavesurfer.getDuration(),o=t.wavesurfer.drawer.handleEvent(n);a.update({start:Math.min(o*s,r*s),end:Math.max(o*s,r*s)})}})}},WaveSurfer.Region={style:WaveSurfer.Drawer.style,init:function(e,t){this.wavesurfer=t,this.wrapper=t.drawer.wrapper,this.id=null==e.id?WaveSurfer.util.getId():e.id,this.start=Number(e.start)||0,this.end=null==e.end?this.start+4/this.wrapper.scrollWidth*this.wavesurfer.getDuration():Number(e.end),this.resize=void 0===e.resize?!0:Boolean(e.resize),this.drag=void 0===e.drag?!0:Boolean(e.drag),this.loop=Boolean(e.loop),this.color=e.color||"rgba(0, 0, 0, 0.1)",this.data=e.data||{},this.bindInOut(),this.render(),this.wavesurfer.fireEvent("region-created",this)},update:function(e){null!=e.start&&(this.start=Number(e.start)),null!=e.end&&(this.end=Number(e.end)),null!=e.loop&&(this.loop=Boolean(e.loop)),null!=e.color&&(this.color=e.color),null!=e.data&&(this.data=e.data),null!=e.resize&&(this.resize=Boolean(e.resize)),null!=e.drag&&(this.drag=Boolean(e.drag)),this.updateRender(),this.fireEvent("update"),this.wavesurfer.fireEvent("region-updated",this)},remove:function(e){this.element&&(this.wrapper.removeChild(this.element),this.element=null,this.fireEvent("remove"),this.wavesurfer.fireEvent("region-removed",this))},play:function(){this.wavesurfer.play(this.start,this.end),this.fireEvent("play"),this.wavesurfer.fireEvent("region-play",this)},playLoop:function(){this.play(),this.once("out",this.playLoop.bind(this))},render:function(){var e=document.createElement("region");e.className="wavesurfer-region",e.title=this.formatTime(this.start,this.end),e.setAttribute("data-id",this.id);this.wrapper.scrollWidth;if(this.style(e,{position:"absolute",zIndex:2,height:"100%",top:"0px"}),this.resize){var i=e.appendChild(document.createElement("handle")),r=e.appendChild(document.createElement("handle"));i.className="wavesurfer-handle wavesurfer-handle-start",r.className="wavesurfer-handle wavesurfer-handle-end";var a={cursor:"col-resize",position:"absolute",left:"0px",top:"0px",width:"1%",maxWidth:"4px",height:"100%"};this.style(i,a),this.style(r,a),this.style(r,{left:"100%"})}this.element=this.wrapper.appendChild(e),this.updateRender(),this.bindEvents(e)},formatTime:function(e,t){return(e==t?[e]:[e,t]).map(function(e){return[Math.floor(e%3600/60),("00"+Math.floor(e%60)).slice(-2)].join(":")}).join("â€“")},updateRender:function(){var e=this.wavesurfer.getDuration(),t=this.wrapper.scrollWidth;this.start<0&&(this.start=0,this.end=this.end-this.start),this.end>e&&(this.end=e,this.start=e-(this.end-this.start)),this.style(this.element,{left:~~(this.start/e*t)+"px",width:~~((this.end-this.start)/e*t)+"px",backgroundColor:this.color,cursor:this.drag?"move":"default"}),this.element.title=this.formatTime(this.start,this.end)},bindInOut:function(){var e=this,t=function(){e.firedIn=!1,e.firedOut=!1},i=function(t){!e.firedIn&&e.start<=t&&e.end>t&&(e.firedIn=!0,e.fireEvent("in"),e.wavesurfer.fireEvent("region-in",e)),!e.firedOut&&e.firedIn&&e.end<=t&&(e.firedOut=!0,e.fireEvent("out"),e.wavesurfer.fireEvent("region-out",e))};this.wavesurfer.on("play",t),this.wavesurfer.backend.on("audioprocess",i),this.on("remove",function(){e.wavesurfer.un("play",t),e.wavesurfer.backend.un("audioprocess",i)}),this.on("out",function(){e.loop&&e.wavesurfer.play(e.start)})},bindEvents:function(){var e=this;this.element.addEventListener("mouseenter",function(t){e.fireEvent("mouseenter",t),e.wavesurfer.fireEvent("region-mouseenter",e,t)}),this.element.addEventListener("mouseleave",function(t){e.fireEvent("mouseleave",t),e.wavesurfer.fireEvent("region-mouseleave",e,t)}),this.element.addEventListener("click",function(t){t.preventDefault(),e.fireEvent("click",t),e.wavesurfer.fireEvent("region-click",e,t)}),this.element.addEventListener("dblclick",function(t){t.stopPropagation(),t.preventDefault(),e.fireEvent("dblclick",t),e.wavesurfer.fireEvent("region-dblclick",e,t)}),(this.drag||this.resize)&&function(){var i,r,a,t=e.wavesurfer.getDuration(),n=function(n){n.stopPropagation(),a=e.wavesurfer.drawer.handleEvent(n)*t,"handle"==n.target.tagName.toLowerCase()?r=n.target.classList.contains("wavesurfer-handle-start")?"start":"end":i=!0},s=function(t){(i||r)&&(i=!1,r=!1,t.stopPropagation(),t.preventDefault(),e.fireEvent("update-end",t),e.wavesurfer.fireEvent("region-update-end",e,t))},o=function(n){if(i||r){var s=e.wavesurfer.drawer.handleEvent(n)*t,o=s-a;a=s,e.drag&&i&&e.onDrag(o),e.resize&&r&&e.onResize(o,r)}};e.element.addEventListener("mousedown",n),e.wrapper.addEventListener("mousemove",o),document.body.addEventListener("mouseup",s),e.on("remove",function(){document.body.removeEventListener("mouseup",s),e.wrapper.removeEventListener("mousemove",o)}),e.wavesurfer.on("destroy",function(){document.body.removeEventListener("mouseup",s)})}()},onDrag:function(e){this.update({start:this.start+e,end:this.end+e})},onResize:function(e,t){"start"==t?this.update({start:Math.min(this.start+e,this.end),end:Math.max(this.start+e,this.end)}):this.update({start:Math.min(this.end+e,this.start),end:Math.max(this.end+e,this.start)})}},WaveSurfer.util.extend(WaveSurfer.Region,WaveSurfer.Observer),WaveSurfer.initRegions=function(){this.regions||(this.regions=Object.create(WaveSurfer.Regions),this.regions.init(this))},WaveSurfer.addRegion=function(e){return this.initRegions(),this.regions.add(e)},WaveSurfer.clearRegions=function(){this.regions&&this.regions.clear()},WaveSurfer.enableDragSelection=function(e){this.initRegions(),this.regions.enableDragSelection(e)};